#!/usr/bin/env python
from os import listdir, statvfs
from collections import namedtuple

Entry = namedtuple('Entry', 'size pid name'.split())

lines = []

for p in listdir('/proc'):
	try: p = int(p)
	except: continue

	try:
		name = open('/proc/%d/comm' % p).read().rstrip('\n')
		n = 0
		with open('/proc/%d/smaps' % p) as f:
			for line in f:
				line = line.split()
				if line[0] in ('Pss:', 'SwapPss:'):
					n += int(line[1])
	except FileNotFoundError:
		continue
	lines.append(Entry(n, p, name))

with open('/proc/mounts') as f:
	for line in f:
		_, dst, type, _, _, _ = line.split()
		if type in ('tmpfs', 'devtmpfs'):
			s = statvfs(dst)
			n = (s.f_blocks - s.f_bfree) * s.f_bsize / 1024
			lines.append(Entry(n, None, dst))

lines.sort(key=lambda e: e.size)
for e in lines:
	print('%8.1f %s%s' % (e.size/1024, '% 6d ' % e.pid if e.pid else '       ', e.name))
